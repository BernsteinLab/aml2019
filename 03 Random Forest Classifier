# The Random forest algorithm is a machine learning approach that uses a large number of binary decision trees that are learned from random subsets of a training set. These trees (the forest) can then be applied to a given sample to generate a class probability that reflects its similarity to a given class of the training set. If a single class prediction is required, the class with the highest probability score is used (majority vote). Random forest classifiers are particularly well suited if the dataset contains many different classes, many samples and many features. In our case samples represent single-cell expression profiles, features represent genes, and classes represent different cell types. For our analysis we used the randomForest R package version 4.6-14.
# We used Random forest-based classification for two different purposes: To predict similarity of single cells to the 15 different cell types detected in healthy BM (classifier 1), and to predict if a single cell from a tumor sample is malignant or normal (classifier 2). To train the first classifier, we first performed a feature selection step to select the most informative genes from all 14,554 expressed genes in the dataset (average expression > 0.01). Feature selection was performed by training an “outer” random forest classifier on all expressed genes. We trained 1,000 trees, using a random subset of 50 cells from each cell type for each tree. Based on the reported overall gene importance in the “outer” classifier, we then selected only the 1,000 most informative genes for training of the “inner” classifier. The reported out-of-bag (OOB) error (i.e. misclassification error of cells that were not used for learning of a given tree) was 20% lower for the “inner” than for the “outer” classifier, justifying the use of an initial feature selection step. The “inner” classifier was further evaluated by performing 5-fold cross-validation by splitting the training dataset into five equally sized parts. In each iteration of the cross-validation, four of these parts were used to generate a classifier that was then used for predicting class probabilities of the remaining part. Results of the cross-validation are provided in Figure S3A.
# The second classifier is used for determining if a cell for which we did not detect a mutant transcript is malignant or normal, based on its similarity to normal and malignant cells (i.e. cells from healthy BM and HSC to myeloid-like cells from tumor samples for which we detected mutant transcripts). We first attempted to use a classifier that distinguishes between just these two classes. However, we achieved much better results by using all 15 normal and six malignant cell types in a combined training set (21 classes), presumably because a malignant monocyte-like cell is more similar to a normal monocyte than to a malignant HSC-like cell. For malignant cells we used cell type annotations as predicted by the first classifier, with the following exceptions: to have at least 65 HSC-like cells for each malignant class (required for having >50 cells for 5-fold cross-validation), we reclassified 23 cells initially classified as progenitor-like with highest prediction scores for the HSC cell type as HSC-like cells. We also reclassified 29 cells that were initially classified as early Erythroid progenitors as progenitor-like cells, if their prediction score for the Progenitor cell type was higher than their prediction score for the late Erythroid cell type. The second classifier was then generated using the combined training set of 21 classes and the same parameters as for the first classifier. The second classifier reached 95.2% sensitivity and 99.7% specificity in distinguishing malignant from normal cells, as measured by 5-fold cross-validation. Results of the 5-fold cross-validation are provided in Figure S3E.
# To exclude the possibility that the high frequency of cells with detected NPM1 mutations affected the classifier, we generated a separate classifier that does not consider NPM1 mutant calls. This separate classifier had equally high specificity (99.8% of normal cells correctly called normal), and sensitivity (93% of malignant cells correctly called malignant) in 5-fold cross-validation. It is also consistent with the original classifier: 97% of cells originally classified as normal were classified as normal; 91% of cells originally classified as malignant were classified as malignant. These results indicate that the classifier is robust to the frequency of NPM1 mutations in the training set.
# To independently assess whether the Random Forest classifier was an appropriate choice for classifying cell types, we compared the performance of our first random forest (RF) classifier to an independent Support vector machine (SVM) classifier. We used the e1071 R package and default parameters, except for assigning class weights inverse to the class size to account for differences in cell numbers per cell population. While the SVM classifier generated reasonable results, it did not perform as well as our random forest classifier in cross-validation. For example, a larger number of cells are misclassified to a different lineage (9.2% vs 3.8%). We conclude that the random forest algorithm is an appropriate choice for classifying cell types in our scRNA-seq data.

# When applying both classifiers to single cells from tumor samples, we first determined from the second classifier if the prediction score was highest for a malignant or normal cell type. If a cell was classified as malignant, we then used the highest prediction score of the HSC to myeloid cell types (HSC, progenitor, GMP, promonocyte, monocyte, cDC) from the first classifier for cell type assignment. If a cell was classified as normal, we used the highest prediction score from the first classifier.
# We evaluated normal and malignant cell predictions by performing unsupervised BackSPIN clustering of all cells that were predicted as one of six HSC to myeloid cell types. This analysis was performed for each patient separately. We included 250 normal cells of each cell type from healthy BM samples in this clustering. For some samples we identified cells for which we could make a better judgement by considering the additional evidence at hand (e.g. mutated transcripts, targeted DNA sequencing results). We then refined these cells as malignant or normal. In total 578 cells were refined as malignant (1.9% of cells), and 573 cells were refined as normal (1.9%). An example of this evaluation is shown in Figure S4A. We also identified eight samples from four different patients for which we were not confident about the classification results (AML314, AML371, AML722B and AML997, 3.7% of cells). These samples were of poorer quality and had fewer detected cells, and were excluded from downstream analyses of malignant cells. Final classification results for each single cell from every sample are provided within annotation files that were deposited in GEO.
# We also used prediction scores for projecting single cells onto the KNN visualization of normal BM cells (shown in Figure 4B, 4H, S5A, S5D). For this purpose, we placed a grid of 50×50 equally sized bins onto the two-dimensional visualization of normal BM cells. We then identified the 20 most highly correlated normal BM cells for every cell to be projected, and recorded the density of these 20 most correlated BM cells for each bin of the grid.

# Code to be provided
